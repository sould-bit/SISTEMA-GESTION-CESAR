üå± Iniciando Master Seed...
üìÅ Directorio de datos: /app/data/seeds
üè¢ Compa√±√≠a: fastops
üîç Dry run: False
üîÑ Reset: False
--------------------------------------------------
üè¢ Creando compa√±√≠as...
DEBUG: Processing company: Restaurante FastOps
DEBUG: Final company_data: {'name': 'Restaurante FastOps', 'description': 'Sistema de gesti√≥n para restaurante', 'is_active': True, 'slug': 'fastops', 'plan': 'premium'}
2025-12-31 19:38:36,985 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-12-31 19:38:36,986 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-31 19:38:36,989 INFO sqlalchemy.engine.Engine select current_schema()
2025-12-31 19:38:36,990 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-31 19:38:36,992 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-12-31 19:38:36,993 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-31 19:38:36,994 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-31 19:38:37,019 INFO sqlalchemy.engine.Engine SELECT companies.id, companies.name, companies.slug, companies.legal_name, companies.tax_id, companies.owner_name, companies.owner_email, companies.owner_phone, companies.plan, companies.is_active, companies.created_at, companies.updated_at 
FROM companies 
WHERE companies.slug = $1::VARCHAR
2025-12-31 19:38:37,020 INFO sqlalchemy.engine.Engine [generated in 0.00092s] ('fastops',)
DEBUG: Processing company: Caf√© Central
DEBUG: Final company_data: {'name': 'Caf√© Central', 'description': 'Cafeter√≠a con servicio express', 'is_active': True, 'slug': 'cafe_central', 'plan': 'basic'}
2025-12-31 19:38:37,027 INFO sqlalchemy.engine.Engine SELECT companies.id, companies.name, companies.slug, companies.legal_name, companies.tax_id, companies.owner_name, companies.owner_email, companies.owner_phone, companies.plan, companies.is_active, companies.created_at, companies.updated_at 
FROM companies 
WHERE companies.slug = $1::VARCHAR
2025-12-31 19:38:37,028 INFO sqlalchemy.engine.Engine [cached since 0.00864s ago] ('cafe_central',)
üìÇ Creando categor√≠as...
2025-12-31 19:38:37,042 INFO sqlalchemy.engine.Engine SELECT permission_categories.id, permission_categories.company_id, permission_categories.name, permission_categories.code, permission_categories.description, permission_categories.icon, permission_categories.color, permission_categories.is_system, permission_categories.is_active, permission_categories.created_at, permission_categories.updated_at 
FROM permission_categories 
WHERE permission_categories.code = $1::VARCHAR AND permission_categories.company_id = $2::INTEGER
2025-12-31 19:38:37,043 INFO sqlalchemy.engine.Engine [generated in 0.00077s] ('user_management', 1)
2025-12-31 19:38:37,046 INFO sqlalchemy.engine.Engine SELECT permission_categories.id, permission_categories.company_id, permission_categories.name, permission_categories.code, permission_categories.description, permission_categories.icon, permission_categories.color, permission_categories.is_system, permission_categories.is_active, permission_categories.created_at, permission_categories.updated_at 
FROM permission_categories 
WHERE permission_categories.code = $1::VARCHAR AND permission_categories.company_id = $2::INTEGER
2025-12-31 19:38:37,047 INFO sqlalchemy.engine.Engine [cached since 0.004561s ago] ('product_management', 1)
2025-12-31 19:38:37,049 INFO sqlalchemy.engine.Engine SELECT permission_categories.id, permission_categories.company_id, permission_categories.name, permission_categories.code, permission_categories.description, permission_categories.icon, permission_categories.color, permission_categories.is_system, permission_categories.is_active, permission_categories.created_at, permission_categories.updated_at 
FROM permission_categories 
WHERE permission_categories.code = $1::VARCHAR AND permission_categories.company_id = $2::INTEGER
2025-12-31 19:38:37,050 INFO sqlalchemy.engine.Engine [cached since 0.007096s ago] ('order_management', 1)
2025-12-31 19:38:37,051 INFO sqlalchemy.engine.Engine SELECT permission_categories.id, permission_categories.company_id, permission_categories.name, permission_categories.code, permission_categories.description, permission_categories.icon, permission_categories.color, permission_categories.is_system, permission_categories.is_active, permission_categories.created_at, permission_categories.updated_at 
FROM permission_categories 
WHERE permission_categories.code = $1::VARCHAR AND permission_categories.company_id = $2::INTEGER
2025-12-31 19:38:37,052 INFO sqlalchemy.engine.Engine [cached since 0.009495s ago] ('reports', 1)
2025-12-31 19:38:37,053 INFO sqlalchemy.engine.Engine SELECT permission_categories.id, permission_categories.company_id, permission_categories.name, permission_categories.code, permission_categories.description, permission_categories.icon, permission_categories.color, permission_categories.is_system, permission_categories.is_active, permission_categories.created_at, permission_categories.updated_at 
FROM permission_categories 
WHERE permission_categories.code = $1::VARCHAR AND permission_categories.company_id = $2::INTEGER
2025-12-31 19:38:37,054 INFO sqlalchemy.engine.Engine [cached since 0.01148s ago] ('cash_management', 1)
2025-12-31 19:38:37,056 INFO sqlalchemy.engine.Engine SELECT permission_categories.id, permission_categories.company_id, permission_categories.name, permission_categories.code, permission_categories.description, permission_categories.icon, permission_categories.color, permission_categories.is_system, permission_categories.is_active, permission_categories.created_at, permission_categories.updated_at 
FROM permission_categories 
WHERE permission_categories.code = $1::VARCHAR AND permission_categories.company_id = $2::INTEGER
2025-12-31 19:38:37,056 INFO sqlalchemy.engine.Engine [cached since 0.01389s ago] ('system', 1)
2025-12-31 19:38:37,058 INFO sqlalchemy.engine.Engine COMMIT
üîê Creando permisos...
2025-12-31 19:38:37,070 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-31 19:38:37,072 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,072 INFO sqlalchemy.engine.Engine [generated in 0.00057s] ('users.read', 1)
2025-12-31 19:38:37,076 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,076 INFO sqlalchemy.engine.Engine [cached since 0.00458s ago] ('users.create', 1)
2025-12-31 19:38:37,078 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,078 INFO sqlalchemy.engine.Engine [cached since 0.006649s ago] ('users.update', 1)
2025-12-31 19:38:37,080 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,080 INFO sqlalchemy.engine.Engine [cached since 0.008522s ago] ('users.delete', 1)
2025-12-31 19:38:37,082 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,083 INFO sqlalchemy.engine.Engine [cached since 0.01116s ago] ('products.read', 1)
2025-12-31 19:38:37,085 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,085 INFO sqlalchemy.engine.Engine [cached since 0.01375s ago] ('products.create', 1)
2025-12-31 19:38:37,087 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,088 INFO sqlalchemy.engine.Engine [cached since 0.01606s ago] ('products.update', 1)
2025-12-31 19:38:37,089 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,090 INFO sqlalchemy.engine.Engine [cached since 0.01858s ago] ('orders.read', 1)
2025-12-31 19:38:37,092 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,092 INFO sqlalchemy.engine.Engine [cached since 0.02071s ago] ('orders.create', 1)
2025-12-31 19:38:37,094 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,094 INFO sqlalchemy.engine.Engine [cached since 0.02269s ago] ('orders.update', 1)
2025-12-31 19:38:37,096 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,097 INFO sqlalchemy.engine.Engine [cached since 0.02513s ago] ('reports.read', 1)
2025-12-31 19:38:37,098 INFO sqlalchemy.engine.Engine SELECT permissions.id, permissions.company_id, permissions.category_id, permissions.code, permissions.name, permissions.description, permissions.resource, permissions.action, permissions.is_system, permissions.is_active, permissions.created_at, permissions.updated_at 
FROM permissions 
WHERE permissions.code = $1::VARCHAR AND permissions.company_id = $2::INTEGER
2025-12-31 19:38:37,099 INFO sqlalchemy.engine.Engine [cached since 0.02756s ago] ('cash.close', 1)
2025-12-31 19:38:37,100 INFO sqlalchemy.engine.Engine COMMIT
üë• Creando roles...
2025-12-31 19:38:37,111 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-31 19:38:37,113 INFO sqlalchemy.engine.Engine SELECT roles.id, roles.company_id, roles.name, roles.code, roles.description, roles.hierarchy_level, roles.is_system, roles.is_active, roles.created_at, roles.updated_at 
FROM roles 
WHERE roles.code = $1::VARCHAR AND roles.company_id = $2::INTEGER
2025-12-31 19:38:37,113 INFO sqlalchemy.engine.Engine [generated in 0.00062s] ('admin', 1)
2025-12-31 19:38:37,117 INFO sqlalchemy.engine.Engine SELECT roles.id, roles.company_id, roles.name, roles.code, roles.description, roles.hierarchy_level, roles.is_system, roles.is_active, roles.created_at, roles.updated_at 
FROM roles 
WHERE roles.code = $1::VARCHAR AND roles.company_id = $2::INTEGER
2025-12-31 19:38:37,117 INFO sqlalchemy.engine.Engine [cached since 0.00454s ago] ('cashier', 1)
2025-12-31 19:38:37,119 INFO sqlalchemy.engine.Engine SELECT roles.id, roles.company_id, roles.name, roles.code, roles.description, roles.hierarchy_level, roles.is_system, roles.is_active, roles.created_at, roles.updated_at 
FROM roles 
WHERE roles.code = $1::VARCHAR AND roles.company_id = $2::INTEGER
2025-12-31 19:38:37,119 INFO sqlalchemy.engine.Engine [cached since 0.006509s ago] ('kitchen', 1)
2025-12-31 19:38:37,120 INFO sqlalchemy.engine.Engine SELECT roles.id, roles.company_id, roles.name, roles.code, roles.description, roles.hierarchy_level, roles.is_system, roles.is_active, roles.created_at, roles.updated_at 
FROM roles 
WHERE roles.code = $1::VARCHAR AND roles.company_id = $2::INTEGER
2025-12-31 19:38:37,121 INFO sqlalchemy.engine.Engine [cached since 0.008397s ago] ('delivery', 1)
2025-12-31 19:38:37,122 INFO sqlalchemy.engine.Engine COMMIT
üîó Asignando permisos a roles...
2025-12-31 19:38:37,131 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-31 19:38:37,132 INFO sqlalchemy.engine.Engine SELECT role_permissions.id, role_permissions.role_id, role_permissions.permission_id, role_permissions.granted_by, role_permissions.granted_at, role_permissions.expires_at 
FROM role_permissions 
WHERE role_permissions.role_id = $1::UUID AND role_permissions.permission_id = $2::UUID
2025-12-31 19:38:37,133 INFO sqlalchemy.engine.Engine [generated in 0.00038s] (UUID('017de0bc-eb01-4b2b-a105-a711e3383e7c'), UUID('ff6e2880-ccf3-486d-b6c6-34dfaebcd71b'))
‚úÖ Permiso asignado: Administrador -> Ver Usuarios
2025-12-31 19:38:37,137 INFO sqlalchemy.engine.Engine INSERT INTO role_permissions (id, role_id, permission_id, granted_by, granted_at, expires_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::INTEGER, $5::TIMESTAMP WITHOUT TIME ZONE, $6::TIMESTAMP WITHOUT TIME ZONE)
2025-12-31 19:38:37,138 INFO sqlalchemy.engine.Engine [generated in 0.00057s] (UUID('3ed50e53-1e8b-4513-addd-ceeed730f363'), UUID('017de0bc-eb01-4b2b-a105-a711e3383e7c'), UUID('ff6e2880-ccf3-486d-b6c6-34dfaebcd71b'), 1, datetime.datetime(2025, 12, 31, 19, 38, 37, 135972), None)
2025-12-31 19:38:37,141 INFO sqlalchemy.engine.Engine ROLLBACK
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.ForeignKeyViolationError: insert or update on table "role_permissions" violates foreign key constraint "role_permissions_granted_by_fkey"
DETAIL:  Key (granted_by)=(1) is not present in table "users".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "role_permissions" violates foreign key constraint "role_permissions_granted_by_fkey"
DETAIL:  Key (granted_by)=(1) is not present in table "users".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/scripts/seed/master_seed.py", line 383, in run
    await self.seed_role_permissions(roles, permissions)
  File "/app/scripts/seed/master_seed.py", line 224, in seed_role_permissions
    result = await self.session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 561, in orm_pre_session_exec
    session._autoflush()
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3061, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3050, in _autoflush
    self.flush()
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "role_permissions" violates foreign key constraint "role_permissions_granted_by_fkey"
DETAIL:  Key (granted_by)=(1) is not present in table "users".
[SQL: INSERT INTO role_permissions (id, role_id, permission_id, granted_by, granted_at, expires_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::INTEGER, $5::TIMESTAMP WITHOUT TIME ZONE, $6::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('3ed50e53-1e8b-4513-addd-ceeed730f363'), UUID('017de0bc-eb01-4b2b-a105-a711e3383e7c'), UUID('ff6e2880-ccf3-486d-b6c6-34dfaebcd71b'), 1, datetime.datetime(2025, 12, 31, 19, 38, 37, 135972), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
‚ùå Error durante el seeding: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "role_permissions" violates foreign key constraint "role_permissions_granted_by_fkey"
DETAIL:  Key (granted_by)=(1) is not present in table "users".
[SQL: INSERT INTO role_permissions (id, role_id, permission_id, granted_by, granted_at, expires_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::INTEGER, $5::TIMESTAMP WITHOUT TIME ZONE, $6::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('3ed50e53-1e8b-4513-addd-ceeed730f363'), UUID('017de0bc-eb01-4b2b-a105-a711e3383e7c'), UUID('ff6e2880-ccf3-486d-b6c6-34dfaebcd71b'), 1, datetime.datetime(2025, 12, 31, 19, 38, 37, 135972), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.ForeignKeyViolationError: insert or update on table "role_permissions" violates foreign key constraint "role_permissions_granted_by_fkey"
DETAIL:  Key (granted_by)=(1) is not present in table "users".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "role_permissions" violates foreign key constraint "role_permissions_granted_by_fkey"
DETAIL:  Key (granted_by)=(1) is not present in table "users".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/scripts/seed/master_seed.py", line 427, in <module>
    asyncio.run(main())
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/scripts/seed/master_seed.py", line 422, in main
    await seeder.run(dry_run=args.dry_run, reset=args.reset)
  File "/app/scripts/seed/master_seed.py", line 383, in run
    await self.seed_role_permissions(roles, permissions)
  File "/app/scripts/seed/master_seed.py", line 224, in seed_role_permissions
    result = await self.session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 561, in orm_pre_session_exec
    session._autoflush()
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3061, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3050, in _autoflush
    self.flush()
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/usr/local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "role_permissions" violates foreign key constraint "role_permissions_granted_by_fkey"
DETAIL:  Key (granted_by)=(1) is not present in table "users".
[SQL: INSERT INTO role_permissions (id, role_id, permission_id, granted_by, granted_at, expires_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::INTEGER, $5::TIMESTAMP WITHOUT TIME ZONE, $6::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('3ed50e53-1e8b-4513-addd-ceeed730f363'), UUID('017de0bc-eb01-4b2b-a105-a711e3383e7c'), UUID('ff6e2880-ccf3-486d-b6c6-34dfaebcd71b'), 1, datetime.datetime(2025, 12, 31, 19, 38, 37, 135972), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
